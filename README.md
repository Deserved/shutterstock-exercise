# Shutterstock exercise
The exercise done using AWS services: Lambda, API Gateway, S3, IAM, DynamoDB, Cloudwatch. Python programming language 
was used as Lambda runtime.

Ideally this implementation would by hidden behind CI/CD Pipeline that can provide feedback on 
running jobs. Developers would follow Git Workflow to deploy test and propagate to production. 
Also it would not require them to have a comprehensive list of tools defined below.

## Prerequisite
**Supportex OS**

Mac, *nix

**Required tools:**

  * [Terragrunt](https://terragrunt.gruntwork.io/docs/getting-started/install/)
  * [Terraform](https://learn.hashicorp.com/terraform/azure/install_az)
  * [Make](https://www.google.com/search?rlz=1C5CHFA_enIE822IE822&sxsrf=ALeKk01Dr4RmnLDj7Leh6ARUhcAqGgSO8A%3A1587639688706&ei=iHWhXs_cKomU1fAP-LSZuAc&q=how+to+install+make&oq=how+to+install+make&gs_lcp=CgZwc3ktYWIQAzIHCAAQFBCHAjICCAAyAggAMgIIADICCAAyAggAMgIIADICCAAyAggAMgIIADoECAAQRzoECCMQJzoFCAAQkQI6BAgAEEM6BQgAEIMBUNsWWKc0YLxDaABwAXgBgAGwAYgBqwuSAQQxNi4zmAEAoAEBqgEHZ3dzLXdpeg&sclient=psy-ab&ved=0ahUKEwjPwLTdsv7oAhUJShUIHXhaBncQ4dUDCAw&uact=5) (specify relevant OS)
  * [Bash](https://www.google.com/search?q=how+to+install+bash&rlz=1C5CHFA_enIE822IE822&oq=how+to+install+bash&aqs=chrome..69i57j69i60.2987j0j4&sourceid=chrome&ie=UTF-8) (O_o)
  * [Python](https://www.codecademy.com/articles/install-python)
  * [Pip](https://pip.pypa.io/en/stable/installing/)
  * [Pytjon Lambda local](https://pypi.org/project/python-lambda-local/)
  * [Zip](https://www.google.com/search?q=how+to+install+zip&rlz=1C5CHFA_enIE822IE822&oq=how+to+install+zip&aqs=chrome..69i57.25970j0j4&sourceid=chrome&ie=UTF-8) (specify relevant OS)
  
**AWS**

Set up [AWS profile](https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html) or export 
AWS_ACCESS_KEY_ID and AWS_ACCESS_KEY_ID environment variables. The user/role has to have full access to work
with Lambda, API Gateway, S3, IAM, DynamoDB, Cloudwatch (hope did not miss anything and sorry for not
providing policy).

## Structure

`src/application/function.py` - source code for REST API  
`src/dataset/instances.json` - dataset for REST API  
`src/package` - source code zip file for Lambda  
`src/terraform` - terraform configuration file for infrastructure  
`src/build` - used by Terragrunt to build package for Lambda  
`src/local` - used by make for local testing  
`src/env.json` - used for local testing, generated by Terragrunt (Yeah could be done differently)  
`src/event.json` - used for local testing, contains values for event parameter in Lambda function.  
`Makefile` - interface for build, test locally and destroy  
`terragrunt.hcl` - Terragrunt configuration file. Entrypoint for infrastructure setup.  

## Build & Deploy
To build infrastructure & deploy run:
```bash
make
```

At the end you will get output with similar URL (it will be different for you):

```
Apply complete! Resources: 0 added, 1 changed, 0 destroyed.

Outputs:

api_url = https://lir0yw64x0.execute-api.eu-west-1.amazonaws.com/api/instances
```

Use the output API URL to do REST calls as in example above:
```bash
curl -i https://lir0yw64x0.execute-api.eu-west-1.amazonaws.com/api/instances
curl -i https://lir0yw64x0.execute-api.eu-west-1.amazonaws.com/api/instances/i-00b7fb83a362506ef
```
Keep in mind that URL above is used for example purpose.

(Sometimes it can take sometime for API Gateway to start work)
If result is found HTTP Status code is 200, otherwise 204 with no content.

**Watning**: S3 and IAM are global resources use `make destroy` if someone else wants to re-create and follow 
process.

## Test Locally
To test locally (first build and deploy):
```bash
make local
```

To test locally and fetch specific instance:
```bash
make local INSTANCE_ID=i-00b7fb83a362506ef
```

## Destroy

To destroy everything was created:
```bash
make destroy
```

